<img src="https://i.imgur.com/zjAqsqy.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p>





<h1>Secure Azure Network with OpenVAS: Vulnerability Scans, Analysis, and Remediation</h1>

Explore my hands-on vulnerability assessment in this tutorial, where you'll create a Windows 10 VM with security gaps, conduct OpenVAS scans, analyze results, remediate vulnerabilities, and craft realistic remediation simulations.".<br />



<h2>Operating Systems Used </h2>

- Windows 10 Pro</b> 

<h2>List of Prerequisites</h2>

- Computer with the Internet
- Azure Account - May Be Possible to do with a Free Subscription




<h2>Create our Free Azure Account</h2>

- Sign up: https://azure.microsoft.com/en-us/free/
- Login: https://portal.azure.com 



 <h2>Prepare Vulnerability Management Scanner</h2>

* https://portal.azure.com → Go to the Marketplace → “OpenVAS secured and supported by HOSSTED”
* “Start with a pre-set configuration” → Pick the weakest one
* “Continue to Create VM”

<img src="https://i.imgur.com/lTzNAVU.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p>


* Resource Group: Vulnerability-Management
* VM Name: OpenVAS (Take note of the region and Vnet–consider East US 2)
* Authentication: Username → azureuser / Cyberlab123!
* Monitoring: Disable Boot Diagnostic (don’t need it)
* Create → Create



 <p><img src="https://i.imgur.com/232rIuG.png" height="80%" width="80%" alt="Disk Sanitization Steps"/> </p>



After the VM has been created, SSH into it With PowerShell (windows) or Terminal (MacOS) using the credentials you created earlier
Don’t touch anything, you’ll notice the “Your openvas is deploying, please wait”
Wait until it says “hossted stage done”

<img src="https://i.imgur.com/xQfr5zX.png" height="80%" width="80%" alt="Disk Sanitization Steps"/>

<p>It should show the web app URL and default username and password at this point, attempt to go to the URL in the browser and login with the username and password.

<img src="https://i.imgur.com/fpZk4we.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p>

<img src="https://i.imgur.com/ABA2ydc.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p>

<img src="https://i.imgur.com/nhOl08G.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p>

<img src="https://i.imgur.com/ts0Fy7O.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p>

<img src="https://i.imgur.com/Po1iTwq.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p>


<h2>Create Client Virtual Machine and Make it Vulnerable</h2>

* https://portal.azure.com/
* Search for Virtual Machines and create a new Virtual Machine
* Resource Group: Vulnerability-Management
* VM Name: Win10-Vulnerable
* Region: Same as the OpenVAS VM (East US 2)
* Virtual Network: Same as OpenVAS (this is important)
* Image: Windows 10 Pro
* Size: Any size with 2 vCPUs
* Username/Password: same as openVAS vm!
* Networking: Same Vnet as OpenVAS
* Create the VM

<img src="https://i.imgur.com/7B37kBg.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p>


After the VM has been created, ensure you can RDP into it with the credentials you created.

<img src="https://i.imgur.com/r2m2Ogb.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p>

  
 After logging in, make the VM vulnerable

<img src="https://i.imgur.com/yML0xqc.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p>


Disable the Windows Firewall

<img src="https://i.imgur.com/qCG5OEk.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p>
<img src="https://i.imgur.com/GBFn81x.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p>
<img src="https://i.imgur.com/BMAfSs0.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p>
<img src="https://i.imgur.com/PdEIbwS.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p>
<img src="https://i.imgur.com/xnvFRYz.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p>

* Install an Old Version of FireFox: Firefox Setup 97.0b5
* Install an Old Version of VLC Player: vlc-1.1.7-win32
* Install an Old Version of Adobe Reader: 10.0_AdbeRdr1000_en_US_1_


 <img src="https://i.imgur.com/j89fPI9.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p> 
 <img src="https://i.imgur.com/8r5qEdZ.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p> 

* Restart the VM
* Leave the VM for now

<h2>Configure and OpenVAS to Perform First Unauthenticated Scan against our Vulnerable VM</h2>

* Login to OpenVAS → Assets → Hosts → New Host
* Add the Client VM PRIVATE IP Address

<img src="https://i.imgur.com/wptWnrK.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p> 
<img src="https://i.imgur.com/LjgwhL1.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p> 

Create a New Target from the Host, name it “Azure Vulnerable VMs”.
Take note of the credentials. We will add SMB credentials later.

<img src="https://i.imgur.com/XgNt1n3.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p> 

* Create a new Task
* Name & Comment: “Scan - Azure Vulnerable VMs”
* Scan Targets → “Azure Vulnerable VMs”
* Save the Task

<img src="https://i.imgur.com/9RV8zNy.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p> 

<img src="https://i.imgur.com/yE9DEe8.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p> 

“Start” the “Scan - Azure Vulnerable VMs” Task
Take note of the Status

<img src="https://i.imgur.com/yE9DEe8.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p> 

Once the scan is finished, click the date under “Last Report” to see the results
Take note of Tabs, specifically the “Results” tab. Even though I installed a super old version of Firefox, note that it does not show up here.
This is because I didn't run a credentialed scan so the scanner could not discover it. I will configure credential scans next.


<img src="https://i.imgur.com/eA2dw5Z.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p><br>

<img src="https://i.imgur.com/2Ubaqhl.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p> 

<h2>Make Configurations for Credentialed Scans (Within VM)</h2>

* Disable Windows Firewall (As shown earlier)
* Disable User Account Control

<img src="https://i.imgur.com/SJZRDRe.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p> 

<img src="https://i.imgur.com/TmJpaeU.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p> 

Enable Remote Registry

<img src="https://i.imgur.com/0P5XGHf.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p> 

<img src="https://i.imgur.com/HK2vOa3.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p> 

Then right click and properties on remote registry and change startup type to automatic 

<img src="https://i.imgur.com/S2cZV1u.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p> 


Set Registry Key

<img src="https://i.imgur.com/m4Ry2PV.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p> 

* Launch Registry Editor (regedit.exe) in “Run as administrator” mode and grant Admin Approval, if requested
* Navigate to HKEY_LOCAL_MACHINE hive
* Open SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System key
* Create a new DWORD (32-bit) value with the following properties:  Name: LocalAccountTokenFilterPolicy  Value: 1
* Close Registry Editor  
* Restart the VM
* Video example below


https://drive.google.com/file/d/1f4a6hXaRASFYyK1sTgj4lEulGtzLUDJS/view?usp=drive_link

<h2>Make Configurations for Credentialed Scans (OpenVAS)</h2>


* Go to Configuration → Credentials → New Credential
* Name / Comment → “Azure VM Credentials”
* Allow Insecure Use: Yes
* Username: azureuser
* Password: Whatever password already used
* Save
* Go to Configuration → Targets → CLONE the Target we made before
* NEW Name / Comment: “Azure Vulnerable VMs - Credentialed Scan”
* Ensure the Private IP is still accurate
* Credentials → SMB → Select the Credentials we just made: Azure VM Credentials
* Save
* Video example below

 https://drive.google.com/file/d/1udRxEqhMVULVVs_aE9s20EYJN9k906um/view?usp=drive_link 

<h2>Execute Credentialed Scan against our Vulnerable Windows VM</h2>

* Within Greenbone / OpenVAS, go to Scans → Tasks
* CLONE the “Scan - Azure Vulnerable VMs” Task, then Edit it:
* Name / Comment → “Scan - Azure Vulnerable VMs - Credentialed”
* Targets: Azure Vulnerable VMs - Credentialed Scan
* Save
* Video example below

https://drive.google.com/file/d/11G3Kv9emMTQUk1kBKEZfNOOrCy25KgQW/view?usp=drive_link

Click the Play button to launch the new Credentialed Scan, wait for it to finish
It will take longer than the last one. Wait for it to finish
After the credentialed scan finishes, you can immediately see the difference in findings:

<img src="https://i.imgur.com/EkUQPAb.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p>  
<img src="https://i.imgur.com/V1ilzuV.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p>  

* Check SMB Login under “Results”
* Further inspect the individual vulnerabilities and see all the Criticals from the out-of-date FireFox
* Remove the Filter (upper right)

<img src="https://i.imgur.com/VdrOq2s.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p>  

<h2>Remediate Vulnerabilities</h2>

* Log back into your Win10-Vulnerable VM
* Uninstall Adobe Reader, VLC Player, and Firefox
* Restart the VM
* Video example below

https://drive.google.com/file/d/1__w1Ri42_-tRiRItWrtwtsvcY_o2m1XG/view?usp=drive_link

<h2>Verify Remediations</h2>

* Re-initiate the “Scan - Azure Vulnerable VMs - Credentialed” scan and observe the results.

<img src="https://i.imgur.com/c0Jlbs9.png" height="80%" width="80%" alt="Disk Sanitization Steps"/></p>  

























 









